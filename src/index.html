<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Calchas Wetterplattform mit Open-Meteo und BrightSky Integration - PWA mit Push-Benachrichtigungen, Favoriten, Offline-Modus"
    />
    <meta name="theme-color" content="#0b101c" />
    <link rel="manifest" href="/manifest.json" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>🌦️</text></svg>"
    />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23007BFF' width='180' height='180' rx='40'/><text x='90' y='130' font-size='140' text-anchor='middle'>🌦️</text></svg>"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mobile.css" media="(max-width: 768px)" />
    <title>Calchas - Aktuelle Wetterdaten</title>
  </head>
  <body>
    <div class="app-shell">
      <div class="app-sky" aria-hidden="true"></div>
      <header class="app-topbar" role="banner">
        <button
          id="settingsBtn"
          class="icon-btn ghost"
          type="button"
          aria-label="Einstellungen öffnen"
        >
          ⚙️
        </button>
        <div class="topbar-location">
          <p id="topbar-location-name">Noch kein Ort</p>
          <small id="topbar-updated">Keine Aktualisierung</small>
        </div>
        <div class="topbar-actions">
          <button
            id="searchFocusBtn"
            class="icon-btn ghost"
            type="button"
            aria-label="Suche fokussieren"
          >
            🔍
          </button>
          <button
            id="favoriteToggle"
            class="icon-btn ghost"
            type="button"
            aria-label="Zu Favoriten hinzufügen"
            data-city=""
          >
            ☆
          </button>
        </div>
      </header>

      <main class="app-main" role="main">
        <div
          id="error-container"
          class="toast-stack"
          aria-live="assertive"
        ></div>

        <section
          class="card-section search-hub"
          id="search-hub"
          aria-labelledby="search-title"
        >
          <div class="search-hub-headline">
            <div>
              <p class="eyebrow">Schnellsuche</p>
              <h1 id="search-title">Direkt zum passenden Ort</h1>
              <p class="helper-text">
                Nutze die globale Suche, setze deinen Heimatort und verwalte
                Favoriten für den schnellen Zugriff.
              </p>
            </div>
            <div class="search-hub-actions">
              <button id="use-home-btn" class="btn-ghost" type="button">
                Heimat laden
              </button>
            </div>
          </div>
          <div class="search-input-group">
            <label class="sr-only" for="cityInput">Ort suchen</label>
            <input
              id="cityInput"
              type="search"
              placeholder="Berlin, Hamburg, Zürich..."
              autocomplete="off"
            />
            <button id="searchBtn" type="button" class="btn-primary">
              Suche
            </button>
          </div>
          <div class="search-meta-grid">
            <div class="recent-panel surface-card">
              <div class="panel-headline">
                <p class="eyebrow">Zuletzt gesucht</p>
                <button id="clear-recent-btn" type="button" class="btn-link">
                  Verlauf löschen
                </button>
              </div>
              <div
                id="recent-cities"
                class="recents-grid"
                role="list"
                aria-live="polite"
              ></div>
            </div>
            <div class="favorites-card surface-card">
              <div class="panel-headline">
                <p class="eyebrow">Favoriten</p>
                <span>Ziehe zum Sortieren</span>
              </div>
              <div class="favorites-list" role="list"></div>
            </div>
          </div>
        </section>

        <section class="grid hero-grid" aria-label="Aktuelle Wetterlage">
          <article
            id="current-weather"
            class="surface-card hero-card"
            aria-live="polite"
          >
            <div class="placeholder-state">
              <p>🔎 Suche nach einem Ort, um Live-Wetter zu sehen.</p>
            </div>
          </article>
          <article class="surface-card overview-card" aria-live="polite">
            <div id="daily-overview" class="overview-slot">
              <div class="placeholder-state">
                <p>🧠 Tagesübersicht erscheint nach der ersten Ortssuche.</p>
              </div>
            </div>
          </article>
        </section>

        <section class="grid detail-grid" aria-label="Vertiefende Einsichten">
          <article class="surface-card" aria-live="polite">
            <div id="climate-panels" class="insights-slot">
              <div class="placeholder-state">
                <p>Messwerte wie Luftfeuchte, UV und Wind folgen nach Abruf.</p>
              </div>
            </div>
          </article>
          <article class="surface-card" aria-live="polite">
            <div id="daily-insights" class="insights-slot">
              <div class="placeholder-state">
                <p>📈 Tagesinsights werden nach Datenabruf erstellt.</p>
              </div>
            </div>
          </article>
          <article class="surface-card" aria-live="polite">
            <div id="sources-comparison" class="insights-slot">
              <div class="placeholder-state">
                <p>Quellenstatus und API-Vergleiche erscheinen hier.</p>
              </div>
            </div>
          </article>
        </section>

        <section
          class="surface-card forecast-card"
          aria-labelledby="forecast-heading"
        >
          <div class="section-headline">
            <div>
              <p class="eyebrow">Prognose</p>
              <h2 id="forecast-heading">Mehr-Tage Verlauf</h2>
            </div>
            <button
              class="btn-tertiary"
              type="button"
              onclick="openSettingsModal()"
            >
              ⚙️ Einstellungen
            </button>
          </div>
          <div
            id="forecast-container"
            class="forecast-shell"
            aria-live="polite"
          ></div>
        </section>

        <section
          class="surface-card hourly-card"
          aria-labelledby="hourly-heading"
        >
          <div class="section-headline">
            <div>
              <p class="eyebrow">Timeline</p>
              <h2 id="hourly-heading">Nächste Stunden</h2>
            </div>
          </div>
          <div
            id="hourly-section"
            class="hourly-shell"
            aria-live="polite"
          ></div>
        </section>

        <section class="grid map-alerts-grid" aria-label="Radar und Warnungen">
          <article class="surface-card map-panel">
            <div class="section-headline">
              <div>
                <p class="eyebrow">Radar & Layers</p>
                <h2>Kartenansicht</h2>
              </div>
              <div id="map-layer-context" class="map-layer-context"></div>
            </div>
            <div class="map-body">
              <div
                id="weather-map"
                class="weather-map"
                role="img"
                aria-label="Interaktive Wetterkarte"
              ></div>
              <div class="map-controls-grid">
                <div id="map-radar-controls" class="map-radar-controls"></div>
                <div id="map-quick-actions" class="map-quick-actions"></div>
                <div id="map-overlay-legend" class="map-overlay-legend"></div>
              </div>
            </div>
            <div
              id="map-inspector"
              class="map-inspector"
              aria-live="polite"
            ></div>
          </article>
          <article
            class="surface-card alerts-panel"
            aria-labelledby="alerts-heading"
          >
            <div class="section-headline">
              <div>
                <p class="eyebrow">Warnmeldungen</p>
                <h2 id="alerts-heading">MeteoAlarm</h2>
              </div>
            </div>
            <div id="weather-alerts" aria-live="polite"></div>
          </article>
        </section>

        <section
          class="grid history-analytics-grid"
          aria-label="Historie und Nutzung"
        >
          <article
            class="surface-card historical-panel"
            aria-labelledby="history-heading"
          >
            <div class="section-headline">
              <div>
                <p class="eyebrow">Rückblick</p>
                <h2 id="history-heading">Historische Daten</h2>
              </div>
            </div>
            <div id="historical-chart" class="historical-shell"></div>
          </article>
          <article
            class="surface-card analytics-panel-container"
            aria-labelledby="analytics-heading"
          >
            <div class="section-headline">
              <div>
                <p class="eyebrow">Nutzungsdaten</p>
                <h2 id="analytics-heading">Analytics</h2>
              </div>
            </div>
            <div id="analytics-panel" class="analytics-shell"></div>
          </article>
        </section>

        <section class="card-section info-card" aria-labelledby="info-heading">
          <div class="card-headline">
            <p class="eyebrow">Datenschutz</p>
            <h2 id="info-heading">Deine Daten gehören dir</h2>
          </div>
          <p>
            Standort, Suchverlauf und Favoriten bleiben lokal auf deinem Gerät.
            Optional gespeicherte API-Keys und Push-Zertifikate verlassen
            niemals deinen Browser.
          </p>
          <p>
            Weitere Details findest du in den verlinkten Legal-Dokumenten im
            Footer oder im Einstellungsdialog.
          </p>
        </section>
      </main>

      <footer class="app-footer" role="contentinfo">
        <p class="footer-text">
          🌐 Datenquellen:
          <a
            href="https://open-meteo.com"
            target="_blank"
            rel="noopener noreferrer"
            >Open-Meteo</a
          >
          |
          <a
            href="https://brightsky.dev"
            target="_blank"
            rel="noopener noreferrer"
            >BrightSky</a
          >
          |
          <a
            href="https://nominatim.org"
            target="_blank"
            rel="noopener noreferrer"
            >Nominatim</a
          >
        </p>
        <p class="footer-text">
          <small>
            © 2025 Calchas |
            <a
              href="../legal/privacy.html"
              target="_blank"
              rel="noopener noreferrer"
              >Datenschutz</a
            >
            |
            <a
              href="../legal/terms.html"
              target="_blank"
              rel="noopener noreferrer"
              >Nutzungsbedingungen</a
            >
          </small>
        </p>
      </footer>
    </div>

    <!-- Settings Modal -->
    <div
      id="settings-modal"
      class="modal"
      role="dialog"
      aria-labelledby="settings-title"
      aria-hidden="true"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="settings-title">Einstellungen</h2>
          <button
            class="modal-close"
            data-close="settings-modal"
            aria-label="Einstellungsfenster schließen"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p class="settings-lead">
            Kompakte Übersicht über alle Feinjustierungen, Quellen und
            Integrationen. Alles Wichtige bleibt hier gebündelt.
          </p>
          <div class="settings-list" role="list">
            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">🎨</div>
              <div class="settings-tile-body">
                <h3>Aussehen</h3>
                <p>Helle oder dunkle Oberfläche für Cockpit und Widgets.</p>
              </div>
              <div class="settings-tile-actions">
                <label class="dark-mode-switch" aria-label="Dark Mode">
                  <span class="switch-label"></span>
                  <input type="checkbox" id="darkModeToggle" />
                  <span class="dark-mode-slider"></span>
                </label>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">🏠</div>
              <div class="settings-tile-body">
                <h3>Heimatort</h3>
                <p>
                  Standard-Ort zum Start der App. Aktuell:
                  <strong id="home-location-label">Nicht gesetzt</strong>
                </p>
              </div>
              <div class="settings-tile-actions">
                <button id="set-home-btn" class="btn-secondary" type="button">
                  Aktuellen Ort speichern
                </button>
                <button id="clear-home-btn" class="btn-link" type="button">
                  Entfernen
                </button>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">📏</div>
              <div class="settings-tile-body">
                <h3>Einheiten</h3>
                <p>Temperatur und Windgeschwindigkeit für alle Anzeigen.</p>
              </div>
              <div class="settings-tile-actions tile-form">
                <label class="tile-field">
                  <span>Temperatur</span>
                  <select id="temp-unit-select" class="settings-select">
                    <option value="C">Celsius (°C)</option>
                    <option value="F">Fahrenheit (°F)</option>
                  </select>
                </label>
                <label class="tile-field">
                  <span>Wind</span>
                  <select id="wind-unit-select" class="settings-select">
                    <option value="km/h">Kilometer pro Stunde (km/h)</option>
                    <option value="m/s">Meter pro Sekunde (m/s)</option>
                    <option value="mph">Meilen pro Stunde (mph)</option>
                  </select>
                </label>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">🌐</div>
              <div class="settings-tile-body">
                <h3>Sprache &amp; Speicher</h3>
                <p>UI-Sprache wählen, Cache &amp; Verlauf pflegen.</p>
              </div>
              <div class="settings-tile-actions tile-form">
                <label class="tile-field">
                  <span>Sprache</span>
                  <select id="lang-select" class="settings-select">
                    <option value="de">Deutsch</option>
                    <option value="en">English</option>
                  </select>
                </label>
                <label class="settings-toggle">
                  <input
                    type="checkbox"
                    id="cache-enabled"
                    checked
                    aria-label="Daten-Caching aktivieren"
                  />
                  <span>Cache aktiv</span>
                </label>
                <div class="settings-quick-actions">
                  <button
                    id="clear-cache-btn"
                    class="btn-secondary"
                    type="button"
                    aria-label="Gecachte Wetterdaten löschen"
                  >
                    Cache leeren
                  </button>
                </div>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">🔄</div>
              <div class="settings-tile-body">
                <h3>Hintergrund-Updates</h3>
                <p>Lege fest, wie häufig Daten erneut geladen werden.</p>
              </div>
              <div class="settings-tile-actions tile-form">
                <label class="tile-field">
                  <span>Interval</span>
                  <select
                    id="background-refresh-select"
                    class="settings-select"
                  >
                    <option value="off">Nur manuell</option>
                    <option value="30">Alle 30 Minuten</option>
                    <option value="60">Stündlich</option>
                  </select>
                </label>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">🔔</div>
              <div class="settings-tile-body">
                <h3>Push-Benachrichtigungen</h3>
                <p>VAPID-Key hinterlegen, um lokale Push-Dienste zu nutzen.</p>
              </div>
              <div class="settings-tile-actions tile-form">
                <div class="settings-quick-actions">
                  <button
                    id="pushToggle"
                    class="btn-secondary"
                    type="button"
                    aria-pressed="false"
                  >
                    🔔
                  </button>
                </div>
                <label class="tile-field">
                  <span>VAPID Public Key</span>
                  <input
                    id="vapidKeyInput"
                    class="settings-input"
                    placeholder="Base64 URL-safe Public VAPID Key"
                    aria-describedby="vapid-help"
                  />
                </label>
                <p id="vapid-help" class="settings-helper">
                  Vom lokalen Push-Server abrufbar oder manuell eintragen.
                </p>
                <div class="settings-quick-actions">
                  <button id="saveVapidBtn" class="btn-secondary" type="button">
                    Speichern
                  </button>
                  <button
                    id="fetchVapidBtn"
                    class="btn-secondary"
                    type="button"
                  >
                    Fetch VAPID
                  </button>
                </div>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">🔑</div>
              <div class="settings-tile-body">
                <h3>APIs &amp; Integrationen</h3>
                <p>Erweiterte Quellen freischalten Eingaben bleiben lokal.</p>
              </div>
              <div class="settings-tile-actions tile-form">
                <div
                  id="api-keys-container"
                  class="settings-input-grid"
                  role="group"
                  aria-label="Optionale API-Keys"
                >
                  <label for="openweathermap-key">
                    OpenWeatherMap Key
                    <input
                      id="openweathermap-key"
                      class="settings-input"
                      placeholder="OpenWeatherMap API Key"
                      aria-label="OpenWeatherMap API Key"
                      type="password"
                    />
                    <small class="settings-helper"
                      >Persönlicher One Call 3.0 Key erforderlich. Hilfe im
                      <a
                        href="../docs/api/API_ACCOUNTS.md#5-openweathermap-optional"
                        target="_blank"
                        rel="noreferrer noopener"
                        >API Guide</a
                      >.
                    </small>
                  </label>
                  <label for="visualcrossing-key">
                    VisualCrossing Key
                    <input
                      id="visualcrossing-key"
                      class="settings-input"
                      placeholder="VisualCrossing API Key"
                      aria-label="VisualCrossing API Key"
                      type="password"
                    />
                  </label>
                  <label for="meteostat-key">
                    Meteostat Key
                    <input
                      id="meteostat-key"
                      class="settings-input"
                      placeholder="Meteostat API Key"
                      aria-label="Meteostat API Key"
                      type="password"
                    />
                  </label>
                </div>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">📊</div>
              <div class="settings-tile-body">
                <h3>Status &amp; Quellen</h3>
                <p>
                  Behalte im Blick, welche Provider aktiv oder optional sind.
                </p>
              </div>
              <div class="settings-tile-actions">
                <div
                  id="api-status"
                  class="api-status-list"
                  role="region"
                  aria-label="Status der Wetterdatenquellen"
                  aria-live="polite"
                ></div>
              </div>
            </article>

            <article class="settings-tile" role="listitem">
              <div class="settings-tile-icon">📄</div>
              <div class="settings-tile-body">
                <h3>Rechtliches &amp; Hinweise</h3>
                <p>
                  Datenschutz, Nutzungsbedingungen und Ansprechpartner in den
                  Legal-Dokumenten.
                </p>
              </div>
              <div class="settings-tile-actions tile-links">
                <a href="../legal/privacy.html" target="_blank">Datenschutz</a>
                <a href="../legal/terms.html" target="_blank">Nutzung</a>
                <a href="../docs/README.md" target="_blank">Projekt-Doku</a>
              </div>
            </article>
          </div>
        </div>
      </div>
    </div>

    <div
      id="day-detail-modal"
      class="day-detail-modal"
      aria-hidden="true"
      role="dialog"
      aria-label="Tagesdetails"
    ></div>
    <div id="modal-overlay" class="modal-overlay" role="presentation"></div>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("service-worker.js")
          .then((reg) => {
            console.log(" Service Worker registriert:", reg);
          })
          .catch((err) => {
            console.warn(" Service Worker Registrierung fehlgeschlagen:", err);
          });
      }
    </script>

    <script src="utils/constants.js"></script>
    <script src="utils/iconMapper.js"></script>
    <script src="utils/cache.js"></script>
    <script src="utils/validation.js"></script>
    <script src="utils/apiKeyManager.js"></script>
    <script src="api/weather.js"></script>
    <script src="api/brightsky.js"></script>
    <script src="api/openweathermap.js"></script>
    <script src="api/visualcrossing.js"></script>
    <script src="api/meteostat.js"></script>
    <script src="api/bigdatacloud.js"></script>
    <script src="api/sunriseSunset.js"></script>
    <script src="api/moonPhase.js"></script>
    <script src="ui/errorHandler.js"></script>
    <script src="ui/searchInput.js"></script>
    <script src="ui/weatherDisplay.js"></script>
    <script src="app.js"></script>
  </body>
</html>
